version: '3.2'
services:
  blaze:
    image: "ghcr.io/samply/blaze:6e698c1ec16b1020d2a2ce41ec5cecf369d21003"
    environment:
      BASE_URL: "http://blaze:8090"
      SERVER_PORT: "8090"
      JAVA_TOOL_OPTIONS: "-Xmx2g"
      LOG_LEVEL: "debug"
    ports:
      - "8090:8090"
    volumes:
      - "blaze-data:/app/data"

  store-fhir-adapter:
    build: .
    environment:
      APP_BASE_URL: "http://store-fhir-adapter:8080"
      APP_STORE_URL: "http://blaze:8090/fhir"
      APP_STORE_PAGE_SIZE: "10"
      JAVA_TOOL_OPTIONS: "-Xmx1g"
    ports:
      - "8080:8080"
    depends_on:
      - blaze

  connector:
    image: "samply/share-client:dktk-id-manager-apikey"
    environment:
      POSTGRES_HOST: "connector-db"
      POSTGRES_DB: "samply.connector"
      POSTGRES_USER: "samply"
      POSTGRES_PASS: "samply"
      STORE_URL: "http://store-fhir-adapter:8080/"
      MDR_URL: "https://mdr.ccp-it.dktk.dkfz.de/v3/api/mdr"
      ID_MANAGER_URL: "http://docker.for.mac.host.internal:8180/ID-Manager/"
      ID_MANAGER_APIKEY: "0Suwrv5Xu7ruIcTzhtfw1eINzGgNJubCjxS1"
      PATIENTLIST_URL: "https://patientlist-test.ccpit.dktk.dkfz.de/mainzelliste"
      PROJECTPSEUDONYMISATION_URL: "https://patientlist-test.ccpit.dktk.dkfz.de/mainzelliste"
      LOG_LEVEL: "debug"
      CATALINA_OPTS: "-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5005"
    ports:
      - "8070:8080"
      - "5005:5005"
    depends_on:
      - store-fhir-adapter
      - connector-db

  connector-db:
    image: "postgres:9.6"
    environment:
      POSTGRES_USER: "samply"
      POSTGRES_PASSWORD: "samply"
      POSTGRES_DB: "samply.connector"
    ports:
      - "5432:5432"
    volumes:
      - "connector-db-data:/var/lib/postgresql/data"

volumes:
  blaze-data:
  connector-db-data:
